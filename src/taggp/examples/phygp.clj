(ns taggp.examples.phygp
  (:use [taggp.core :exclude [-main evolve]]))

(def closing-data
[["MSFT"
  [35.22
   35.37
   34.38
   34.61
   33.45
   34.44
   34.33
   33.91
   34.39
   34.0
   33.23
   33.11
   33.01
   31.96
   31.93
   33.25
   32.94
   32.72
   32.6
   32.2
   32.6
   30.45
   30.19
   29.07
   28.52
   28.12
   28.56
   28.21
   28.34
   28.96
   28.5
   28.42
   28.17
   28.22
   28.1
   27.68
   27.84
   28.38
   28.26
   27.93
   27.2
   26.99
   27.59
   28.12
   27.57
   27.87
   28.05
   29.28
   28.63
   28.62
   27.96
   28.3
   29.42
   28.62
   29.18
   29.17
   29.14
   28.56
   28.05
   27.91
   28.38
   29.5
   29.16
   29.0
   29.16
   29.16
   28.75
   28.89
   29.11
   28.28
   28.06
   28.25
   28.95
   29.22
   30.0
   30.42
   30.25
   31.45
   31.8
   29.83
   28.99
   28.64
   28.52
   29.4
   29.24
   29.08
   29.7
   29.21
   29.27
   29.39
   29.99
   29.78
   29.93
   30.45
   29.99
   29.46
   28.76
   28.25
   28.47
   28.05
   28.44
   28.18
   28.31
   28.32
   27.8
   27.31
   27.54
   28.3
   27.49
   27.71
   27.89
   27.12
   28.24
   29.07
   28.93
   28.8
   28.46
   28.93
   28.23
   27.97
   27.73
   28.35
   27.75
   27.63
   27.51
   26.87
   25.88
   25.98
   26.03
   25.85
   25.23
   25.45
   25.25
   25.15
   26.15
   27.26
   27.52
   25.86
   25.64
   25.8
   26.43
   25.44
   26.16
   25.5
   26.11
   26.23
   25.72
   25.44
   25.28
   26.21
   27.02
   27.39
   28.13
   27.9
   28.12
   27.91
   27.91
   27.81
   27.69
   27.32
   27.29
   27.18
   27.84
   27.66
   27.27
   27.56
   27.94
   27.29
   27.1
   26.9
   26.35
   25.65
   26.12
   26.1
   26.44
   27.34
   27.62
   26.82
   25.99
   24.57
   25.26
   25.16
   25.4
   25.44
   25.72
   26.61
   27.4
   25.01
   26.69
   26.48
   26.25
   26.32
   24.91
   23.23
   23.01
   22.3
   21.5
   25.5
   24.1
   22.66
   24.19
   23.93
   24.72
   23.36
   21.53
   22.32
   21.96
   21.18
   23.1
   23.0
   22.63
   22.33
   22.62
   23.53
   22.08
   20.88
   21.5
   21.3
   21.2
   20.3
   21.25
   20.06
   19.32
   19.62
   18.29
   17.53
   19.68
   20.69
   19.99
   20.49
   20.22
   18.61
   19.15
   19.87
   19.11
   19.87
   21.01
   20.6
   20.61
   19.45
   19.36
   19.04
   20.11
   19.66
   19.3
   19.12
   19.18
   19.28
   19.17
   19.13
   18.96
   19.34
   19.44]]
 ["INTC"
  [25.35
   24.67
   22.67
   22.88
   22.26
   22.75
   22.54
   21.99
   23.08
   22.69
   19.88
   19.33
   19.0
   18.61
   19.98
   20.69
   20.0
   20.29
   20.5
   20.69
   21.1
   21.77
   21.2
   20.12
   19.92
   20.05
   20.27
   20.68
   20.9
   21.21
   20.46
   20.11
   20.16
   20.38
   20.3
   19.82
   19.94
   20.69
   20.77
   20.49
   19.97
   20.01
   20.0
   20.2
   19.87
   20.07
   20.12
   21.2
   21.12
   21.28
   20.66
   20.85
   21.75
   21.09
   21.75
   22.13
   22.27
   21.86
   21.09
   20.79
   21.18
   21.97
   21.85
   21.93
   21.87
   21.75
   21.08
   21.42
   22.08
   21.24
   20.69
   20.91
   22.13
   22.11
   22.55
   22.46
   21.99
   22.56
   22.69
   22.56
   22.71
   22.62
   22.26
   23.29
   23.58
   23.25
   23.58
   23.17
   23.4
   23.37
   23.64
   23.76
   23.84
   24.97
   25.0
   24.88
   24.09
   23.66
   23.88
   23.41
   23.6
   23.47
   23.14
   23.18
   23.2
   22.94
   23.48
   23.87
   22.9
   22.76
   22.68
   21.81
   22.05
   22.66
   22.86
   22.58
   22.28
   22.85
   22.37
   22.36
   22.41
   22.65
   21.59
   21.49
   21.48
   21.57
   20.93
   20.66
   20.71
   20.92
   19.81
   20.62
   20.64
   20.47
   20.71
   20.91
   21.99
   22.09
   22.09
   22.09
   22.3
   21.67
   22.01
   21.67
   22.23
   22.23
   22.19
   22.35
   22.52
   23.02
   22.8
   23.67
   24.23
   24.38
   24.52
   24.12
   24.36
   24.26
   24.01
   23.59
   23.39
   23.05
   23.49
   22.97
   23.15
   23.41
   23.59
   22.87
   22.58
   21.54
   20.52
   20.61
   20.97
   20.33
   20.16
   20.19
   20.16
   19.36
   19.48
   18.55
   19.26
   19.23
   18.5
   18.63
   18.7
   18.57
   19.2
   17.27
   18.73
   18.52
   17.2
   17.31
   16.93
   16.02
   16.25
   15.6
   15.19
   16.99
   15.93
   14.99
   15.88
   15.5
   16.04
   15.25
   14.58
   14.51
   14.28
   14.25
   15.86
   14.94
   16.17
   16.03
   15.64
   16.26
   15.06
   13.87
   14.63
   14.35
   13.93
   13.52
   14.43
   13.32
   13.0
   13.11
   12.49
   12.23
   13.11
   13.56
   13.13
   13.97
   13.8
   12.56
   13.28
   13.66
   12.77
   13.29
   13.94
   14.3
   14.27
   14.01
   14.75
   14.59
   15.64
   15.26
   14.26
   14.44
   14.34
   14.07
   14.23
   14.18
   14.13
   14.69
   14.66]]
 ["SIRI"
  [3.05
   3.15
   3.12
   2.94
   2.98
   2.85
   2.89
   2.93
   2.85
   2.84
   2.75
   2.69
   2.83
   2.65
   2.84
   2.95
   2.89
   3.08
   3.1
   3.06
   3.2
   3.31
   3.27
   3.12
   3.13
   3.13
   3.19
   3.14
   3.1
   3.18
   3.19
   3.23
   3.1
   3.0
   2.92
   2.92
   3.04
   3.05
   2.94
   2.93
   2.84
   2.77
   2.8
   2.84
   2.74
   2.73
   2.66
   2.75
   2.88
   2.84
   2.73
   2.69
   2.73
   2.79
   2.9
   3.15
   3.09
   3.02
   2.83
   2.8
   2.86
   2.89
   2.84
   2.79
   2.79
   2.74
   2.69
   2.61
   2.55
   2.48
   2.44
   2.41
   2.45
   2.42
   2.48
   2.45
   2.58
   2.65
   2.73
   2.69
   2.69
   2.7
   2.57
   2.69
   2.7
   2.67
   2.79
   2.8
   2.83
   2.73
   2.87
   2.83
   2.81
   2.8
   2.72
   2.67
   2.62
   2.58
   2.63
   2.59
   2.6
   2.56
   2.59
   2.52
   2.54
   2.57
   2.66
   2.7
   2.57
   2.57
   2.55
   2.45
   2.4
   2.54
   2.62
   2.5
   2.43
   2.13
   1.99
   1.93
   1.86
   1.93
   1.83
   2.1
   1.92
   1.95
   1.91
   1.92
   1.98
   2.0
   2.0
   2.13
   2.13
   2.06
   2.02
   2.07
   2.1
   2.28
   2.42
   2.38
   2.68
   2.42
   2.25
   1.88
   1.58
   1.65
   1.6
   1.46
   1.39
   1.42
   1.45
   1.4
   1.32
   1.47
   1.37
   1.38
   1.43
   1.49
   1.4
   1.47
   1.42
   1.39
   1.39
   1.33
   1.31
   1.33
   1.36
   1.33
   1.33
   1.31
   1.26
   1.3
   1.26
   1.14
   0.98
   0.92
   0.95
   0.85
   0.88
   0.94
   0.95
   1.0
   0.89
   0.85
   0.86
   0.86
   0.76
   0.62
   0.57
   0.65
   0.6
   0.58
   0.5
   0.48
   0.46
   0.4
   0.43
   0.51
   0.48
   0.42
   0.39
   0.38
   0.39
   0.36
   0.31
   0.25
   0.29
   0.38
   0.36
   0.38
   0.35
   0.34
   0.31
   0.32
   0.26
   0.26
   0.26
   0.27
   0.25
   0.25
   0.27
   0.26
   0.23
   0.2
   0.16
   0.14
   0.14
   0.16
   0.15
   0.18
   0.2
   0.17
   0.18
   0.17
   0.16
   0.15
   0.15
   0.15
   0.16
   0.15
   0.14
   0.14
   0.15
   0.13
   0.14
   0.12
   0.12
   0.12
   0.12
   0.13
   0.13
   0.12
   0.12]]
 ["CSCO"
  [26.54
   26.75
   26.12
   26.13
   25.43
   26.24
   26.24
   25.87
   26.29
   25.85
   25.15
   24.33
   24.3
   23.48
   24.03
   25.11
   24.2
   24.1
   24.06
   24.36
   24.5
   24.94
   23.82
   23.26
   23.08
   23.38
   23.54
   23.52
   23.43
   24.06
   23.53
   23.3
   22.88
   23.2
   23.19
   23.6
   23.8
   24.07
   24.95
   24.66
   24.39
   24.4
   24.29
   24.27
   23.94
   24.11
   23.99
   25.15
   25.14
   24.95
   24.32
   24.29
   25.58
   24.47
   24.77
   25.64
   25.75
   24.78
   24.18
   24.08
   24.09
   24.98
   24.96
   24.23
   24.39
   23.94
   23.96
   23.53
   24.04
   23.38
   23.31
   23.11
   23.83
   23.89
   24.51
   24.89
   24.92
   25.44
   26.03
   25.6
   25.35
   25.51
   25.64
   26.67
   26.75
   26.28
   26.33
   25.78
   25.7
   25.49
   25.84
   25.89
   25.75
   26.5
   26.51
   26.37
   25.85
   25.37
   25.58
   25.1
   25.59
   25.54
   26.21
   26.72
   26.35
   26.34
   26.76
   27.54
   26.54
   26.43
   26.36
   25.65
   25.96
   26.37
   26.27
   25.97
   25.28
   25.52
   24.64
   24.55
   24.48
   24.7
   23.82
   23.61
   23.26
   23.15
   22.84
   23.12
   22.57
   22.88
   21.58
   22.13
   21.82
   21.3
   21.04
   21.1
   21.52
   21.66
   21.84
   21.9
   22.17
   21.76
   22.43
   21.98
   22.42
   22.17
   21.99
   21.99
   21.99
   22.65
   23.93
   23.58
   24.25
   24.62
   24.5
   24.31
   24.67
   24.91
   24.49
   24.24
   24.23
   24.23
   24.71
   24.21
   24.11
   24.37
   24.66
   24.05
   23.75
   23.31
   22.28
   22.26
   23.37
   22.97
   22.99
   23.05
   23.46
   22.38
   22.8
   21.8
   22.8
   24.29
   23.11
   22.73
   22.8
   23.48
   23.82
   21.79
   22.56
   21.95
   21.2
   21.25
   20.46
   18.84
   18.34
   17.19
   17.23
   19.27
   18.54
   16.57
   17.75
   17.91
   18.96
   17.86
   17.41
   17.24
   16.31
   16.09
   18.31
   17.87
   17.79
   17.77
   17.2
   18.33
   17.39
   16.94
   17.58
   17.57
   17.18
   16.55
   17.26
   16.62
   16.21
   16.45
   15.08
   14.47
   15.17
   16.4
   15.42
   16.39
   16.54
   14.96
   15.32
   16.01
   15.33
   15.94
   17.25
   17.16
   17.33
   16.91
   16.99
   16.84
   17.42
   16.84
   16.66
   16.64
   16.37
   16.24
   16.35
   16.27
   16.01
   16.23
   16.3]]
 ["QQQ"
  [50.41
   50.62
   48.4
   48.17
   46.92
   47.92
   47.99
   47.05
   47.87
   46.55
   46.05
   45.41
   45.35
   44.18
   44.01
   44.91
   43.99
   44.33
   44.41
   44.37
   45.13
   45.59
   44.95
   43.67
   42.81
   43.11
   43.6
   44.07
   43.82
   44.78
   43.97
   43.82
   43.74
   43.94
   43.52
   43.68
   43.9
   44.07
   44.29
   44.12
   42.95
   42.67
   42.91
   43.12
   42.17
   42.07
   41.26
   42.83
   42.71
   43.04
   42.25
   41.48
   43.33
   42.26
   43.09
   44.58
   44.83
   44.7
   43.71
   43.49
   43.72
   45.59
   45.49
   45.59
   45.86
   45.76
   45.41
   44.9
   45.54
   44.28
   44.08
   44.14
   45.37
   45.27
   46.71
   47.04
   46.34
   46.85
   47.27
   47.15
   47.24
   47.6
   47.21
   48.7
   48.77
   48.63
   48.93
   48.04
   48.4
   48.21
   49.09
   49.22
   49.11
   49.97
   50.01
   49.65
   49.27
   48.18
   48.35
   48.2
   49.05
   49.25
   49.69
   50.01
   49.4
   49.13
   49.76
   50.55
   49.03
   48.77
   48.54
   47.37
   47.42
   48.37
   48.8
   48.54
   48.02
   48.77
   47.42
   47.05
   46.81
   47.57
   45.65
   45.65
   45.17
   45.81
   44.71
   44.63
   44.9
   45.97
   44.75
   45.28
   44.56
   44.23
   44.24
   45.34
   45.64
   44.59
   44.78
   44.78
   45.37
   44.69
   45.27
   44.42
   45.34
   45.57
   45.46
   44.88
   44.43
   45.93
   46.63
   46.27
   47.32
   47.75
   47.8
   47.7
   48.25
   48.16
   47.6
   47.01
   47.09
   46.87
   47.49
   46.49
   46.43
   46.73
   47.11
   46.12
   45.55
   45.12
   43.66
   43.45
   43.37
   42.45
   42.8
   43.6
   43.43
   42.08
   42.41
   40.21
   41.57
   42.9
   40.88
   40.57
   40.85
   41.5
   41.08
   37.82
   38.91
   38.5
   36.75
   36.18
   34.86
   32.65
   32.39
   31.52
   31.32
   35.13
   33.61
   30.6
   32.26
   32.3
   33.2
   31.48
   30.61
   30.49
   29.51
   28.69
   31.86
   31.78
   32.84
   32.89
   32.82
   33.75
   31.99
   30.56
   31.19
   30.77
   30.1
   28.71
   30.46
   28.98
   28.37
   28.34
   26.86
   25.56
   26.67
   28.3
   28.17
   29.35
   29.12
   26.93
   27.83
   28.62
   27.81
   28.94
   30.08
   30.01
   29.91
   29.09
   29.68
   29.16
   30.56
   30.19
   29.66
   29.86
   29.21
   29.06
   29.14
   29.13
   28.89
   29.49
   29.74]]
 ["BAC"
  [40.56
   40.3
   39.85
   39.9
   38.41
   38.74
   39.3
   38.5
   39.22
   37.88
   38.69
   36.91
   35.97
   37.39
   40.57
   39.9
   39.48
   41.2
   41.94
   42.21
   44.15
   45.03
   44.03
   42.37
   42.33
   43.37
   42.16
   42.14
   42.82
   43.33
   42.24
   42.7
   42.67
   42.97
   42.21
   42.6
   42.94
   42.72
   42.88
   41.42
   39.74
   39.18
   38.78
   37.55
   36.52
   36.74
   35.31
   37.72
   37.03
   37.14
   35.69
   35.96
   38.93
   38.56
   41.86
   42.45
   40.97
   39.84
   38.64
   38.07
   37.91
   40.86
   40.3
   40.37
   39.41
   39.5
   38.38
   37.93
   37.69
   36.94
   35.58
   35.58
   36.98
   37.47
   38.56
   37.61
   37.0
   36.86
   37.87
   38.3
   38.18
   37.86
   37.54
   39.39
   39.79
   38.97
   39.24
   38.0
   37.33
   36.65
   37.44
   36.61
   36.8
   36.71
   36.17
   36.1
   35.39
   34.63
   34.73
   33.93
   34.17
   33.87
   34.6
   34.01
   33.58
   33.31
   31.99
   31.99
   30.5
   29.61
   29.62
   28.85
   29.44
   29.78
   30.32
   29.24
   28.37
   28.14
   27.1
   25.88
   26.62
   26.61
   24.81
   24.59
   23.87
   23.81
   22.54
   22.4
   21.53
   23.54
   22.06
   22.36
   21.67
   20.15
   18.52
   22.67
   26.5
   27.49
   28.56
   32.35
   33.44
   30.64
   29.58
   28.06
   32.22
   33.61
   32.9
   33.33
   32.62
   33.58
   33.45
   31.52
   32.25
   33.38
   31.13
   28.86
   30.18
   30.7
   29.3
   28.08
   29.29
   29.04
   30.21
   28.96
   29.02
   29.65
   31.43
   31.14
   32.63
   32.96
   30.6
   32.23
   34.73
   32.52
   32.4
   33.06
   33.74
   26.55
   29.55
   27.2
   30.58
   37.48
   34.15
   33.3
   33.07
   34.37
   36.7
   30.25
   35.0
   38.13
   36.37
   34.48
   32.22
   23.77
   22.1
   19.63
   20.87
   22.79
   26.53
   23.82
   24.25
   23.24
   24.4
   23.97
   22.66
   23.0
   21.07
   20.53
   23.02
   22.32
   22.78
   24.17
   23.61
   24.53
   21.75
   20.12
   20.49
   19.48
   18.69
   17.0
   17.1
   16.42
   15.03
   15.19
   13.06
   11.25
   11.47
   14.59
   14.8
   15.43
   16.25
   12.85
   14.37
   15.05
   14.34
   15.24
   17.84
   16.95
   16.69
   14.91
   14.93
   14.11
   15.1
   14.62
   13.96
   13.8
   13.53
   12.75
   13.53
   13.36
   12.94
   13.24
   14.08]]
 ["GE"
  [36.76
   36.8
   36.04
   36.18
   35.4
   35.8
   35.92
   35.17
   35.46
   34.53
   34.56
   33.21
   34.31
   34.05
   34.59
   34.65
   34.0
   34.72
   34.76
   34.94
   35.36
   36.16
   35.37
   34.21
   34.2
   34.23
   33.84
   34.01
   34.37
   34.98
   34.39
   34.37
   34.28
   34.36
   33.69
   33.55
   34.21
   33.94
   34.02
   33.85
   33.14
   33.4
   33.52
   33.67
   32.86
   32.23
   31.7
   33.4
   33.96
   34.25
   33.82
   34.33
   36.14
   35.59
   37.49
   37.4
   37.27
   37.13
   36.83
   36.61
   37.01
   38.43
   38.02
   37.84
   37.56
   37.26
   36.95
   36.44
   36.75
   32.05
   31.75
   31.98
   32.23
   32.02
   32.69
   32.46
   32.33
   32.36
   32.81
   33.33
   33.17
   32.82
   32.7
   33.12
   33.34
   33.18
   33.0
   32.57
   32.59
   32.27
   32.4
   32.33
   32.51
   32.37
   32.13
   32.4
   31.72
   30.99
   31.01
   30.43
   30.4
   30.55
   30.64
   30.72
   30.41
   30.46
   30.45
   31.06
   30.02
   30.06
   30.33
   29.83
   29.05
   29.15
   28.97
   28.86
   28.21
   27.91
   27.38
   27.4
   27.59
   27.99
   26.53
   26.26
   26.69
   27.12
   26.51
   26.91
   27.1
   28.06
   27.19
   27.64
   27.66
   27.18
   26.65
   27.68
   28.0
   28.0
   27.69
   28.5
   29.33
   28.71
   28.71
   27.69
   28.4
   28.97
   28.29
   28.21
   28.17
   29.25
   29.0
   28.57
   29.64
   29.95
   29.74
   29.31
   29.52
   29.8
   29.35
   28.71
   28.65
   28.75
   29.12
   28.32
   28.27
   28.22
   28.83
   28.1
   28.53
   28.57
   27.7
   27.88
   29.09
   28.12
   28.09
   28.16
   26.75
   24.6
   25.06
   23.39
   24.79
   26.62
   26.15
   24.95
   24.59
   25.68
   25.25
   23.1
   25.5
   24.5
   22.15
   21.57
   21.38
   20.3
   20.65
   19.01
   21.5
   21.0
   20.85
   19.25
   19.89
   19.63
   20.14
   20.35
   18.96
   18.8
   17.83
   17.73
   19.49
   19.2
   19.35
   19.51
   19.3
   20.77
   19.93
   18.34
   18.86
   18.45
   17.81
   16.29
   16.86
   16.02
   16.11
   16.06
   14.45
   12.84
   14.03
   15.26
   15.77
   16.19
   17.17
   15.5
   17.61
   18.13
   17.55
   17.85
   18.88
   17.78
   18.0
   17.05
   17.11
   16.95
   17.92
   17.39
   15.96
   16.5
   16.07
   16.43
   16.11
   15.97
   15.66
   15.82
   16.2]]
 ["C"
  [28.92
   28.93
   28.24
   28.26
   27.14
   27.49
   28.11
   28.56
   29.06
   26.94
   26.24
   24.96
   24.45
   24.4
   26.36
   27.33
   26.64
   27.65
   27.91
   27.88
   28.17
   29.69
   29.22
   27.05
   26.92
   26.7
   26.03
   25.81
   26.21
   26.34
   25.74
   25.48
   25.32
   25.49
   25.05
   25.12
   24.74
   24.95
   25.72
   25.01
   23.71
   23.09
   22.1
   22.15
   21.17
   20.91
   19.69
   21.49
   21.21
   21.07
   19.78
   18.62
   20.71
   20.41
   22.5
   23.27
   23.42
   22.05
   21.79
   20.83
   21.42
   23.84
   24.02
   24.36
   24.08
   24.6
   23.76
   23.58
   23.71
   23.36
   22.51
   22.8
   23.44
   24.03
   25.11
   25.03
   25.12
   24.63
   25.76
   26.6
   26.81
   26.32
   25.27
   25.99
   26.39
   25.75
   25.87
   24.48
   24.3
   23.63
   23.64
   23.03
   23.25
   23.73
   23.12
   22.99
   22.11
   21.06
   21.72
   21.12
   21.66
   21.6
   22.04
   21.89
   21.46
   21.42
   21.08
   21.22
   20.06
   19.6
   20.26
   19.21
   19.89
   20.48
   20.83
   20.46
   20.4
   20.17
   19.3
   18.55
   18.85
   18.85
   17.67
   17.25
   16.76
   17.13
   16.84
   16.82
   16.4
   17.39
   16.44
   16.28
   16.19
   15.22
   14.56
   16.47
   17.97
   19.35
   19.69
   20.89
   21.12
   19.06
   18.85
   17.43
   18.45
   18.81
   18.69
   18.87
   18.83
   19.92
   19.7
   18.47
   19.39
   19.82
   18.54
   17.81
   18.08
   18.55
   17.62
   17.19
   17.49
   17.47
   18.14
   17.61
   17.84
   18.12
   19.08
   18.99
   19.11
   19.61
   18.3
   19.07
   20.32
   18.88
   18.68
   18.61
   17.96
   15.24
   15.75
   14.03
   16.65
   20.65
   20.01
   19.99
   18.96
   19.41
   20.15
   17.75
   20.51
   23.0
   22.5
   18.35
   17.41
   15.15
   14.4
   12.93
   14.11
   15.75
   18.62
   16.23
   15.9
   14.88
   15.09
   14.18
   13.32
   13.11
   12.14
   11.73
   13.41
   12.91
   13.11
   13.65
   13.99
   14.68
   12.63
   11.52
   11.82
   11.21
   10.8
   9.64
   9.45
   9.52
   8.89
   8.36
   6.4
   4.71
   3.77
   5.95
   6.08
   7.05
   8.29
   6.45
   7.22
   7.82
   7.4
   7.71
   8.47
   8.54
   8.3
   7.57
   7.7
   7.4
   8.23
   7.83
   7.43
   7.02
   6.75
   6.52
   6.78
   6.73
   6.57
   6.8
   6.71]]
 ["F"
  [6.6
   6.45
   6.13
   6.16
   6.1
   6.07
   6.25
   6.06
   6.18
   5.97
   5.86
   5.76
   5.92
   5.93
   6.3
   6.26
   6.58
   6.67
   6.69
   6.75
   6.64
   6.85
   6.68
   6.43
   6.31
   6.17
   6.08
   6.39
   6.46
   6.58
   6.46
   6.45
   6.48
   6.41
   6.23
   6.25
   6.46
   6.52
   6.6
   6.62
   6.53
   6.18
   6.13
   6.12
   5.94
   5.78
   5.6
   5.9
   5.7
   5.39
   5.29
   5.11
   5.29
   5.45
   5.62
   5.96
   6.0
   5.87
   5.83
   5.59
   5.72
   5.97
   6.13
   6.46
   6.49
   6.73
   6.91
   6.72
   6.74
   6.69
   6.78
   6.88
   7.19
   7.26
   7.45
   7.73
   7.65
   7.52
   8.4
   7.5
   8.21
   8.12
   8.26
   8.48
   8.27
   8.33
   8.27
   7.96
   8.2
   8.1
   8.15
   8.23
   8.14
   8.17
   8.11
   8.02
   8.0
   7.8
   7.16
   6.87
   6.8
   6.78
   6.71
   6.8
   6.64
   6.68
   6.46
   6.4
   6.04
   6.36
   6.12
   5.97
   6.0
   6.27
   6.5
   6.6
   6.22
   6.32
   5.81
   5.28
   5.32
   5.24
   5.07
   4.98
   4.81
   4.71
   4.36
   4.42
   4.47
   4.9
   4.95
   4.58
   4.86
   4.66
   4.65
   5.49
   5.49
   5.44
   5.48
   5.84
   6.03
   5.11
   5.05
   4.75
   5.02
   4.84
   4.8
   4.65
   4.81
   5.09
   4.94
   4.86
   5.26
   5.16
   5.19
   4.88
   5.1
   5.11
   4.89
   4.72
   4.61
   4.42
   4.47
   4.41
   4.35
   4.26
   4.43
   4.46
   4.51
   4.57
   4.39
   4.41
   4.55
   4.4
   4.47
   4.68
   4.91
   4.74
   5.07
   4.94
   5.28
   5.29
   4.95
   4.86
   5.03
   4.98
   4.81
   4.17
   5.2
   4.55
   4.35
   4.05
   3.69
   2.92
   2.66
   2.08
   1.99
   2.39
   2.45
   2.3
   2.27
   2.43
   2.33
   2.17
   2.1
   2.0
   2.01
   2.03
   2.15
   2.16
   2.28
   2.19
   2.13
   2.16
   2.09
   1.98
   2.02
   1.93
   1.8
   1.84
   1.9
   1.8
   1.72
   1.68
   1.26
   1.39
   1.43
   1.56
   1.66
   2.15
   2.69
   2.55
   2.7
   2.85
   2.66
   2.72
   3.38
   3.23
   3.25
   2.9
   3.04
   3.18
   3.13
   3.14
   2.84
   2.95
   2.59
   2.19
   2.11
   2.29
   2.22
   2.29
   2.29]]
 ["PFE"
  [22.91
   23.18
   22.83
   23.23
   23.47
   23.92
   24.08
   24.02
   23.97
   23.59
   23.4
   22.96
   22.5
   22.23
   22.86
   23.05
   22.61
   22.99
   23.18
   23.1
   23.36
   23.59
   23.63
   22.96
   22.59
   22.67
   22.3
   22.2
   22.68
   22.74
   22.45
   22.33
   22.37
   22.47
   22.4
   22.5
   22.78
   22.83
   22.75
   22.55
   22.28
   22.25
   22.24
   22.05
   21.59
   21.35
   21.15
   21.72
   21.28
   21.21
   20.64
   20.57
   21.0
   20.61
   20.59
   20.61
   20.78
   20.69
   20.56
   20.5
   20.93
   21.38
   21.51
   21.34
   21.35
   21.48
   21.0
   20.89
   20.92
   20.45
   20.56
   20.71
   21.1
   20.4
   20.47
   20.2
   19.79
   19.88
   20.04
   20.43
   20.23
   20.24
   20.11
   20.44
   20.61
   20.52
   20.42
   19.92
   19.97
   19.79
   19.91
   19.97
   20.06
   20.08
   20.03
   20.23
   20.05
   20.01
   19.78
   19.53
   19.33
   19.3
   19.4
   19.36
   19.18
   19.01
   18.8
   18.67
   17.96
   18.02
   17.94
   17.55
   17.73
   17.99
   17.77
   17.72
   17.77
   17.77
   17.33
   17.38
   17.69
   17.88
   17.17
   17.28
   17.47
   17.73
   17.62
   17.75
   17.39
   18.19
   18.03
   18.03
   17.81
   17.65
   17.58
   18.26
   18.39
   18.32
   18.09
   18.35
   19.07
   18.81
   18.89
   18.36
   18.53
   18.88
   18.67
   18.6
   18.98
   19.71
   19.43
   19.21
   19.84
   19.88
   19.72
   19.64
   19.78
   19.97
   19.64
   19.34
   19.28
   19.37
   19.75
   19.51
   19.28
   19.08
   19.27
   19.11
   19.17
   19.2
   18.67
   18.51
   19.14
   18.24
   18.2
   18.39
   18.62
   18.05
   17.81
   17.17
   17.99
   18.55
   18.07
   18.01
   17.99
   18.64
   18.66
   17.65
   18.44
   18.94
   18.79
   19.0
   18.94
   17.65
   17.13
   15.67
   15.14
   16.68
   17.13
   16.27
   16.97
   16.91
   17.34
   17.34
   16.74
   17.1
   16.57
   16.39
   17.82
   17.19
   17.86
   17.71
   17.76
   18.41
   17.0
   16.37
   16.86
   16.6
   16.77
   15.83
   16.73
   16.28
   15.92
   16.29
   15.56
   14.45
   15.67
   16.04
   15.94
   16.07
   16.43
   15.28
   16.02
   16.62
   16.27
   16.55
   16.93
   16.47
   16.57
   16.56
   16.92
   16.63
   17.36
   17.25
   17.12
   17.3
   17.18
   17.03
   17.01
   17.1
   17.29
   17.75
   17.71]]]
)

(defn avg [& nums] (/ (reduce + nums) (count nums)))

(def averaged-closing-data
  (vec (apply (partial map avg) (map second closing-data))))

(def target-data (atom [[{'yesterday 0 'lastweek 0 'avyesterday 0 'avlastweek 0} 0]]))

(defn sin [n] (Math/sin n))

(defn cos [n] (Math/cos n))

(defn noop0 [] 0)
  
(defn noop1 [a] a)

(defn error
  "Error function for testing individuals."
  [individual]
  (reduce +' (map (fn [[bindings target]] 
                    (let [result (eval-with-tagging individual @execution-limit bindings 0)]
                      (if (= result :limit-exceeded) 
                        @penalty-for-exceeding-limit
                        (abs (-' result target)))))
                  @target-data)))

(defn set-target-from-generation
  [g]
  (reset! target-data 
          (let [my-closings (second (first closing-data))] ;; only care about first guy, except for averages
            (for [day (range 10)]
              [{'lastweek (get my-closings (+ g day))
                'yesterday (get my-closings (+ 4 g day))
                'avlastweek (get averaged-closing-data (+ g day))
                'avyesterday (get averaged-closing-data (+ 4 g day))}
               (get my-closings (+ 5 g day))]))))

(def cumulative-best-error-past-gen100 (atom 0))
(def cumulative-median-error-past-gen100 (atom 0))

(defn evolve []
  (println "allow-tagging =" @allow-tagging)
  (println "tagdo-semantics =" @tagdo-semantics)
  (println "use-noops =" @use-noops)
  (println "trivial-geography-radius =" @trivial-geography-radius)
  (println "population-size =" @population-size)
  (println "max-generations =" @maximum-generations)  
  (update-terminal-proportion)
  (println "Starting evolution...")
  (loop [generation 0
         population (pair-with-errors 
                      (concat (repeatedly (/ @population-size 2) #(random-code (ramp-depth) :grow))
                              (repeatedly (/ @population-size 2) #(random-code (ramp-depth) :full))))]
    (let [sorted (sort #(< (second %1) (second %2)) population)]
      (println "Generation:" generation)
      (println "Best error:" (second (first sorted)))
      (println "Best program:" (first (first sorted)))
      (println "Best program size:" (codesize (first (first sorted))))
      (println "Best program depth:" (depth (first (first sorted))))
      (println "     Median error:" (second (nth sorted 
                                                 (int (/ @population-size 2)))))
      (println "     Average program size:" 
               (float (/ (reduce + (map codesize (map first population)))
                         (count population))))
      (println "     Average program depth:" 
               (float (/ (reduce + (map depth (map first population)))
                         (count population))))
      (println "     Tag call ratio:"
               (float (/ (count (filter :tag (filter map? (flatten (map first population)))))
                         (count (flatten (map first population))))))
      (println "     Tagged call ratio:"
               (float (/ (count (filter :tagged (filter map? (flatten (map first population)))))
                         (count (flatten (map first population))))))
      (println "     Tagged-with-args call ratio:"
               (float (/ (count (filter :tagged-with-args (filter map? (flatten (map first population)))))
                         (count (flatten (map first population))))))
      (println "     Unique error values in population:"
               (count (distinct (map second population))))
      (when (> generation 100)
        (swap! cumulative-median-error-past-gen100 #(+ % (second (nth sorted (int (/ @population-size 2))))))
        (swap! cumulative-best-error-past-gen100 #(+ % (second (first sorted)))))
      (if (>= generation (- (apply min (map count (map second closing-data))) 16))  
        (do (println "Cumulative best error after gen 100:" @cumulative-best-error-past-gen100)
            (println "Cumulative median error after gen 100:" @cumulative-median-error-past-gen100))
        (do (flush)
            (set-target-from-generation (inc generation))
            (recur 
              (inc generation)
              (pair-with-errors
                (for [i (range @population-size)]
                  (let [operator (rand)
                        tsize @reproductive-tournament-size
                        radius @trivial-geography-radius]
                    (cond (< operator 
                             @mutation-fraction)      (mutate (select population tsize i radius))
                          (< operator 
                             (+ @mutation-fraction 
                                @crossover-fraction)) (crossover (select population tsize i radius)
                                                                 (select population tsize i radius))
                          :else (select population tsize i radius)))))))))))


(defn run
  "An evolutionary run. This is separated for REPL usage."
  []
  (reset! allow-tagging false)
  (reset! function-table
          (if @allow-tagging
            (zipmap '(+' -' *' pd sin cos :tagged-erf :tag-erf :tagged-with-args-erf)
                    '(2  2  2  2  1   1   0           1         1))
            (if @use-noops
              (zipmap '(+' -' *' pd sin cos noop0 noop1 noop1)
                      '(2  2  2  2  1   1   0     1     1))
              (zipmap '(+' -' *' pd sin cos)
                      '(2  2  2  2  1   1  )))))
  (reset! terminal-set
          (if @allow-tagging
            '(yesterday lastweek avyesterday avlastweek :float-erc arg0)
            '(yesterday lastweek avyesterday avlastweek :float-erc)))
  (reset! ramp-depth-range [2 6])
  (reset! population-size 1000)
  (reset! error-fn error)       
  (evolve))

(defn -main 
  [& params]
  (in-ns 'taggp.examples.phygp) ;; when using lein run (= *ns* 'user) by default, we need to switch
  (let [params (merge {:allow-tagging true
                       :tagdo-semantics true
                       :use-noops true}
                      (apply hash-map (map read-string params)))]
    (println "target-data =" target-data)
    (reset! allow-tagging (:allow-tagging params))
    (reset! tagdo-semantics (:tagdo-semantics params))
    (reset! use-noops (:use-noops params))
    (run)
    (System/exit 0)))

(run)

;; with tags
;; Cumulative best error after gen 100: 458.9131191566641
;; Cumulative median error after gen 100: 737.4302673158595

;; without tags
;; Cumulative best error after gen 100: 679.2260713195806
;; Cumulative median error after gen 100: 2468.02480705738

;; with tags
;; Cumulative best error after gen 100: 512.3656478074194
;; Cumulative median error after gen 100: 796.5254578748385

;; without tags
;; Cumulative best error after gen 100: 503.18814803139935
;; Cumulative median error after gen 100: 799.6514697767087

;; with tags
;; Cumulative best error after gen 100: 553.3202154762209
;; Cumulative median error after gen 100: 776.1923666438616

;; without tags
;; Cumulative best error after gen 100: 435.85741386413594
;; Cumulative median error after gen 100: 690.601939315796